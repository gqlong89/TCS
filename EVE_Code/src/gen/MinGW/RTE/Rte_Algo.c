/** @file     Rte_Algo.c
  * 
  * @brief    RTE Sample SWC implementation skeleton file
  * 
  * @note     Generated by ETAS GmbH  RTA-RTE v5.8.4  (R4.0 backend version: v7.8.7 (Build 46772))
  */

#include "Rte_Algo.h"

/* --------------------------------------------------------------------------- */
/* RTE Event: /Component/Algo/IB_Algo/Sensor_EVENT */

FUNC(void, Algo_CODE) RunnableEntity_Send_func(VAR(float64, AUTOMATIC) DLWheelSpeed,
                                               VAR(float64, AUTOMATIC) DRWheelSpeed,
                                               VAR(float64, AUTOMATIC) ULWheelSpeed,
                                               VAR(float64, AUTOMATIC) URWheelSpeed,
                                               VAR(float64, AUTOMATIC) Gyro,
                                               VAR(float64, AUTOMATIC) CarSpeed,
                                               VAR(float64, AUTOMATIC) SteeringAngle)
{
   /* ... */
	float64 DLSliprate = 0;
	float64 DRSliprate = 0;
	float64 ULSliprate = 0;
	float64 URSliprate = 0;
	float64 DLBrakeValue = 0;
	float64 DRBrakeValue = 0;
	float64 ULBrakeValue = 0;
	float64 URBrakeValue = 0;

	float64 max = 0;
	float64 UD=0;
	float64 LR=0;

	if(DLWheelSpeed!=0)
		DLSliprate = (DLWheelSpeed - CarSpeed)/DLWheelSpeed;
	else
		DLSliprate = 0;

	if(DRWheelSpeed!=0)
		DRSliprate = (DRWheelSpeed - CarSpeed)/DRWheelSpeed;
	else
		DRSliprate = 0;

	if(ULWheelSpeed!=0)
		ULSliprate = (ULWheelSpeed - CarSpeed)/ULWheelSpeed;
	else
		ULSliprate = 0;

	if(URWheelSpeed!=0)
		URSliprate = (URWheelSpeed - CarSpeed)/URWheelSpeed;
	else
		URSliprate = 0;


	max = DLSliprate;
	if (DRSliprate > max)
	max = DRSliprate;
	if (ULSliprate > max)
	max = ULSliprate;
	if (URSliprate > max)
	max = URSliprate;

	UD = SteeringAngle - Gyro;
	LR = SteeringAngle;

	if(max>0.2)
		Rte_Write_Engine_PPort_Throttle(CarSpeed*0.4);
	else
		Rte_Write_Engine_PPort_Throttle(CarSpeed*0.5);

		if(LR>40)//우
		{
			if(UD>0)//언더
				DRBrakeValue=DRBrakeValue+100;
			else if(UD < 0)
				URBrakeValue=URBrakeValue+100;
		}
		else if(LR==40){
			if(Gyro>40){
						URBrakeValue=URBrakeValue+100;
			}
			else if(Gyro<40){
						ULBrakeValue=ULBrakeValue+100;
			}
			else
				;

		}
		else//좌
		{
			if(UD<0)//언더
				DLBrakeValue=DLBrakeValue+100;
			else
				ULBrakeValue=ULBrakeValue+100;
		}

		if(DLSliprate>0.2)
			DLBrakeValue=DLBrakeValue+40;
		if(DRSliprate>0.2)
			DRBrakeValue=DRBrakeValue+40;
		if(ULSliprate>0.2)
			ULBrakeValue=ULBrakeValue+40;
		if(URSliprate>0.2)
			URBrakeValue=URBrakeValue+40;


	Rte_Call_BrakeValue_RPort_ClientServerOperation_Brake(DLBrakeValue,DRBrakeValue,ULBrakeValue,URBrakeValue);
}

